#################################################
# MCUs
#################################################
[mcu]
serial:         /dev/serial/by-id/usb-Klipper_stm32f446xx_32004D001550335331383520-if00
restart_method: command

#################################################
# Temperature Sensors
#################################################
[temperature_sensor mcu_temp]
sensor_type:    temperature_mcu
min_temp:       0
max_temp:       100

[temperature_sensor raspberry_pi]
sensor_type:    temperature_host
min_temp:       0
max_temp:       100

#################################################
# Printer
#################################################
[printer]
kinematics:             corexy
max_velocity:           1000
max_accel:              15000
max_z_velocity:         15
max_z_accel:            350
square_corner_velocity: 10.0

[gcode_arcs]
resolution: 0.2

[exclude_object]

#################################################
# Board Pin Aliases
#################################################
[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

[resonance_tester]
accel_chip: beacon
probe_points: 150,150,20

[temperature_sensor chamber_temp_rear]
sensor_type: PT1000
sensor_pin: PF4
min_temp: -50
max_temp: 500

[temperature_sensor chamber_temp_front]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5
min_temp: -50
max_temp: 300

[temperature_sensor chamber_temp]
sensor_type: temperature_combined
sensor_list: temperature_sensor chamber_temp_rear, temperature_sensor chamber_temp_front
combination_method: mean
maximum_deviation: 999.9

#################################################
# Bed
####################################################
[heater_bed]
heater_pin:     PA2
sensor_type:    Generic 3950
sensor_pin:     PF3
max_power:      0.6
min_temp:       0
max_temp:       120
#control:        pid
#pid_kp:         58.437
#pid_ki:         2.347
#pid_kd:         363.769

#################################################
# Quad Gantry Level
#################################################
[quad_gantry_level]
gantry_corners:
    -60,-10
    360,370
points:
    50,25
    50,205
    245,205
    245,25
speed: 100
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

#################################################
# Steppers
#################################################
[stepper_x]
step_pin:                   PF13
dir_pin:                    PF12
enable_pin:                 !PF14
rotation_distance:          40
microsteps:                 64 # Previously 32
full_steps_per_rotation:    200
endstop_pin:                tmc5160_stepper_x:virtual_endstop
position_min:               0
position_endstop:           295
position_max:               295
homing_speed:               150
homing_retract_dist:        0
homing_positive_dir:        true

[stepper_y]
step_pin:                   PG0
dir_pin:                    PG1
enable_pin:                 !PF15
rotation_distance:          40
microsteps:                 64 # Previously 32
full_steps_per_rotation:    200
endstop_pin:                tmc5160_stepper_y:virtual_endstop
position_min:               0
position_endstop:           300
position_max:               300
homing_speed:               150
homing_retract_dist:        0
homing_positive_dir:        true

[stepper_z]
step_pin:           PF9
dir_pin:            PF10
enable_pin:         !PG2
rotation_distance:  40
gear_ratio:         80:16
microsteps:         32
endstop_pin: probe:z_virtual_endstop
position_max: 180
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

[stepper_z1]
step_pin:           PC13
dir_pin:            !PF0
enable_pin:         !PF1
rotation_distance:  40
gear_ratio:         80:16
microsteps:         32

[stepper_z2]
step_pin:           PE2
dir_pin:            PE3
enable_pin:         !PD4
rotation_distance:  40
gear_ratio:         80:16
microsteps:         32

[stepper_z3]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

[extruder]
step_pin:                   PF11
dir_pin:                    !PG3
enable_pin:                 !PG5
rotation_distance:          23.2207386093612240898464
gear_ratio:                 50:8
microsteps:                 16
full_steps_per_rotation:    200
nozzle_diameter:            0.400
filament_diameter:          1.75
heater_pin:                 PB10
sensor_pin:                 PF6
sensor_type:                PT1000
max_extrude_only_accel:     1500
max_extrude_cross_section:  50
min_temp:                   0
max_temp:                   350
max_power:                  1.0
min_extrude_temp:           0
max_extrude_only_distance:  250
pressure_advance_smooth_time: .02
#control:                    pid
#pid_kp:                     26.213
#pid_ki:                     1.304
#pid_kd:                     131.721

#################################################
# Drivers
#################################################
[tmc5160 stepper_x]
cs_pin:                 PC4
interpolate:            false
run_current:            1.9
sense_resistor:         0.075
diag1_pin:              ^!PG6
spi_software_sclk_pin:  EXP2_2
spi_software_mosi_pin:  EXP2_6
spi_software_miso_pin:  EXP2_1
driver_SGT: 1


[tmc5160 stepper_y]
cs_pin:                 PD11
interpolate:            false
run_current:            1.9
sense_resistor:         0.075
diag1_pin:               ^!PG9
spi_software_sclk_pin:  EXP2_2
spi_software_mosi_pin:  EXP2_6
spi_software_miso_pin:  EXP2_1
driver_SGT: 1

[tmc2209 stepper_z]
uart_pin:               PC7
interpolate:            false
run_current:            1.0
sense_resistor:         0.110

[tmc2209 stepper_z1]
uart_pin:               PF2
interpolate:            false
run_current:            1.0
sense_resistor:         0.110

[tmc2209 stepper_z2]
uart_pin:               PE4
interpolate:            false
run_current:            1.0
sense_resistor:         0.110

[tmc2209 stepper_z3]
uart_pin:               PE1
interpolate:            false
run_current:            1.0
sense_resistor:         0.110

[tmc2209 extruder]
uart_pin:               PC6
interpolate:            false
run_current:            0.65
sense_resistor:         0.110
stealthchop_threshold:  0

[autotune_tmc stepper_x]
motor: ldo-42sth48-2804ah
tuning_goal: performance
sgt: 1
voltage: 48

[autotune_tmc stepper_y]
motor: ldo-42sth48-2804ah
tuning_goal: performance
sgt: 1
voltage: 48

[autotune_tmc stepper_z]
motor: omc-17hs19-2004s1
tuning_goal: performance
voltage: 24

[autotune_tmc stepper_z1]
motor: omc-17hs19-2004s1
tuning_goal: performance
voltage: 24

[autotune_tmc stepper_z2]
motor: omc-17hs19-2004s1
tuning_goal: performance
voltage: 24

[autotune_tmc stepper_z3]
motor: omc-17hs19-2004s1
tuning_goal: performance
voltage: 24

#################################################
# Libs
#################################################
[include ./lib/Mainsail/ui.cfg]
[include ./lib/KAMP/KAMP.cfg]
[include ./lib/Fans/fans.cfg]
[include ./lib/PrintStatus/printStatus.cfg]
[include ./lib/InputShaping/inputShaping.cfg]
[include ./lib/Beacon/beacon.cfg]
[include ./lib/LED/led.cfg]
[include ./lib/BedMesh/bedMesh.cfg]
[include ./lib/Parking/parkTH.cfg]
[include ./lib/States/state.cfg]


#################################################
# Macros
#################################################

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 38.334
#*# pid_ki = 1.367
#*# pid_kd = 268.817
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 22.451
#*# pid_ki = 1.969
#*# pid_kd = 63.984
#*#
#*# [probe]
#*# z_offset = 8.375
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.005589, 0.006173, 0.005285, 0.004754, 0.006098, 0.005150, 0.003572, 0.002869, 0.002102, -0.000325, 0.000111, 0.000471, 0.001773, 0.003123, 0.005280, 0.007436, 0.010309, 0.011302, 0.011443, 0.012191, 0.012216, 0.012682, 0.012415, 0.012218, 0.011157, 0.010103, 0.009819, 0.007894
#*# 	  0.004130, 0.004529, 0.003776, 0.004800, 0.004238, 0.003925, 0.003340, 0.001036, -0.000232, -0.001619, -0.002066, -0.000960, 0.000310, 0.000456, 0.003218, 0.005248, 0.007014, 0.008142, 0.008370, 0.009146, 0.009946, 0.010256, 0.009843, 0.009056, 0.008616, 0.008720, 0.007447, 0.006180
#*# 	  0.003706, 0.003323, 0.002975, 0.003881, 0.001803, 0.004807, 0.001192, 0.000676, -0.001570, -0.005105, -0.004193, -0.002625, -0.001476, -0.000853, 0.001070, 0.002637, 0.004550, 0.004543, 0.006156, 0.006771, 0.007239, 0.007875, 0.007366, 0.006905, 0.006458, 0.006489, 0.005671, 0.004866
#*# 	  0.003807, 0.003616, 0.003388, 0.003462, 0.002889, 0.002951, 0.002606, -0.000397, -0.002220, -0.004047, -0.004319, -0.003481, -0.002112, -0.000676, -0.000245, 0.001137, 0.003191, 0.003386, 0.004404, 0.005314, 0.005268, 0.005716, 0.006053, 0.004977, 0.004293, 0.004124, 0.004254, 0.002983
#*# 	  0.006449, 0.006025, 0.005349, 0.004919, 0.005283, 0.004856, 0.003872, 0.002712, 0.000768, -0.001695, -0.003725, -0.000647, -0.000295, 0.000421, 0.001538, 0.002721, 0.003484, 0.004073, 0.004679, 0.005268, 0.005339, 0.005449, 0.005014, 0.004396, 0.004266, 0.004662, 0.002894, 0.002898
#*# 	  0.008625, 0.007211, 0.005639, 0.005298, 0.005695, 0.005191, 0.004924, 0.003071, 0.001303, -0.001043, -0.001201, -0.000344, 0.001059, 0.002208, 0.000101, 0.002401, 0.003031, 0.003000, 0.003841, 0.003784, 0.004288, 0.003959, 0.002356, 0.002676, 0.001498, 0.000884, 0.001462, -0.001505
#*# 	  0.007422, 0.006000, 0.005055, 0.001350, 0.006546, 0.004596, 0.003526, 0.003203, -0.001490, -0.001040, -0.000535, 0.000366, 0.001157, 0.001198, 0.001183, 0.001825, 0.000574, 0.004056, 0.002605, 0.002036, 0.001979, 0.000743, 0.001825, -0.000487, -0.001906, -0.002586, -0.003838, -0.003815
#*# 	  0.007141, 0.006308, 0.004522, 0.003751, 0.004286, 0.004607, 0.004077, 0.004089, 0.002025, 0.001261, 0.001199, 0.001199, 0.001473, 0.001904, 0.001380, 0.002590, 0.001349, 0.003437, 0.003139, 0.003463, 0.002564, 0.001148, 0.001603, -0.000808, -0.003870, -0.004221, -0.004838, -0.005924
#*# 	  0.006806, 0.003032, 0.004482, 0.004184, 0.004070, 0.004642, 0.004670, 0.004279, 0.002970, 0.001316, 0.003886, 0.002989, 0.003319, 0.002923, 0.001778, 0.003286, 0.003548, 0.003621, 0.003268, 0.002992, 0.001997, 0.001092, 0.000397, -0.001098, -0.004520, -0.005130, -0.006813, -0.005845
#*# 	  0.004998, 0.004029, 0.003713, 0.003161, 0.003390, 0.003655, 0.003946, 0.003382, 0.002982, 0.001755, 0.001859, 0.003210, 0.003931, 0.003862, 0.004686, 0.003057, 0.002760, 0.002393, 0.001832, 0.000602, -0.000443, -0.001374, -0.001552, -0.004548, -0.006313, -0.007423, -0.008582, -0.008996
#*# 	  0.003485, 0.002500, 0.001910, 0.005501, 0.002533, 0.003064, 0.003031, 0.001594, 0.003158, 0.002764, 0.003124, 0.003778, 0.003692, 0.003169, 0.002818, 0.002681, 0.004243, 0.001653, 0.000945, -0.000459, -0.003791, -0.002614, -0.004152, -0.005220, -0.006887, -0.007612, -0.009468, -0.010743
#*# 	  0.000295, -0.000946, -0.001727, -0.001164, -0.000990, 0.000098, 0.000147, 0.000532, 0.001405, 0.000764, 0.000972, 0.001318, 0.001695, 0.001693, 0.000873, 0.000381, -0.000174, -0.002407, -0.003126, -0.003356, -0.004805, -0.005333, -0.007624, -0.007296, -0.008832, -0.010249, -0.011728, -0.013404
#*# 	  -0.003147, -0.002425, -0.001599, -0.001706, -0.000787, -0.000222, -0.000087, 0.000162, 0.000203, 0.001678, 0.001188, 0.000949, 0.001353, -0.000159, 0.000212, -0.000468, -0.001542, -0.003242, -0.004616, -0.005445, -0.006783, -0.006532, -0.006788, -0.007980, -0.008437, -0.009794, -0.011906, -0.013116
#*# 	  -0.002657, -0.002955, -0.001807, -0.001598, -0.001087, -0.001005, -0.000686, 0.000978, 0.000249, 0.000500, 0.001386, 0.000881, 0.001198, 0.000489, -0.001241, -0.000488, -0.002506, -0.004024, -0.005920, -0.006892, -0.007663, -0.007357, -0.007654, -0.007659, -0.010426, -0.009408, -0.011765, -0.013665
#*# 	  -0.003871, -0.002811, 0.000381, -0.000944, -0.000237, 0.000489, 0.000424, 0.001473, 0.001564, 0.002782, 0.002571, 0.003420, 0.001988, 0.000836, -0.000797, -0.000503, -0.003141, -0.005332, -0.006998, -0.008304, -0.008716, -0.007482, -0.007721, -0.008129, -0.008946, -0.009293, -0.010781, -0.013064
#*# 	  -0.003456, -0.003024, -0.001213, -0.000203, -0.000246, 0.000259, 0.000529, 0.001877, 0.002279, 0.004368, 0.003523, 0.003681, 0.002658, 0.000223, -0.000929, -0.002098, -0.004022, -0.005839, -0.008610, -0.009246, -0.009734, -0.009398, -0.007358, -0.007693, -0.009189, -0.009282, -0.010608, -0.013283
#*# 	  -0.004932, -0.002950, -0.001469, 0.000041, 0.000979, 0.001207, 0.002487, 0.002972, 0.004414, 0.004444, 0.005199, 0.004439, 0.001932, 0.000081, -0.001556, -0.004214, -0.005747, -0.007295, -0.008677, -0.010726, -0.011336, -0.010200, -0.008785, -0.008936, -0.009040, -0.009577, -0.011220, -0.013651
#*# 	  -0.005266, -0.003492, -0.001594, -0.001096, 0.000563, 0.001205, 0.002050, 0.003296, 0.004635, 0.005605, 0.005105, 0.003881, 0.003302, -0.000617, -0.002989, -0.005479, -0.007143, -0.008510, -0.010035, -0.011552, -0.012005, -0.011057, -0.009711, -0.008787, -0.009489, -0.009606, -0.010700, -0.012889
#*# 	  -0.001677, 0.000861, 0.001878, 0.003607, 0.004198, 0.005465, 0.006600, 0.008442, 0.009334, 0.009773, 0.009889, 0.008546, 0.005474, 0.002718, -0.000513, -0.002662, -0.004593, -0.005619, -0.006864, -0.007934, -0.008623, -0.007963, -0.006711, -0.006818, -0.006775, -0.006381, -0.006547, -0.008505
#*# 	  0.003639, 0.004802, 0.005783, 0.007105, 0.008074, 0.009659, 0.011294, 0.012712, 0.013133, 0.013230, 0.013091, 0.011637, 0.006837, 0.004740, 0.001816, -0.000765, -0.001950, -0.002328, -0.003070, -0.005864, -0.005510, -0.005401, -0.004920, -0.003530, -0.003555, -0.003990, -0.003596, -0.003825
#*# 	  0.002886, 0.004771, 0.006196, 0.007861, 0.008901, 0.009620, 0.011759, 0.013668, 0.014580, 0.013749, 0.013142, 0.009864, 0.007593, 0.004065, 0.002390, -0.000395, -0.001363, -0.001954, -0.002578, -0.003673, -0.004465, -0.005092, -0.004380, -0.004604, -0.004771, -0.003436, -0.003100, -0.002431
#*# 	  0.003837, 0.004661, 0.005702, 0.007275, 0.008621, 0.009695, 0.011963, 0.013161, 0.013859, 0.013023, 0.011473, 0.009092, 0.006544, 0.002689, 0.000717, -0.000874, -0.001364, -0.001173, -0.001874, -0.003426, -0.003208, -0.003590, -0.003642, -0.002849, -0.003062, -0.002776, -0.002611, -0.001616
#*# 	  0.004102, 0.005779, 0.007236, 0.009514, 0.010884, 0.011878, 0.012929, 0.014560, 0.015415, 0.014574, 0.012576, 0.010346, 0.007261, 0.004922, 0.001750, 0.001606, 0.001073, 0.001047, 0.000201, -0.000785, -0.001320, -0.000904, 0.000420, 0.000093, 0.000057, 0.000834, 0.001202, 0.001189
#*# 	  0.007239, 0.008592, 0.010862, 0.011437, 0.012853, 0.014138, 0.015381, 0.016685, 0.017844, 0.016864, 0.015774, 0.013080, 0.010618, 0.008246, 0.006203, 0.004814, 0.005216, 0.005478, 0.004323, 0.003876, 0.002119, 0.003596, 0.003978, 0.004520, 0.006270, 0.005834, 0.004384, 0.003961
#*# 	  0.005829, 0.007638, 0.010130, 0.011043, 0.012865, 0.013696, 0.014577, 0.016832, 0.017088, 0.015938, 0.013880, 0.013158, 0.010472, 0.008474, 0.006813, 0.006920, 0.006574, 0.005715, 0.005620, 0.004191, 0.003537, 0.004214, 0.005514, 0.006480, 0.006857, 0.006230, 0.005535, 0.004150
#*# 	  0.005033, 0.006040, 0.008699, 0.010046, 0.011648, 0.012621, 0.013801, 0.014917, 0.016354, 0.015703, 0.014953, 0.013909, 0.012086, 0.011083, 0.008579, 0.008774, 0.008916, 0.008289, 0.008084, 0.005456, 0.005355, 0.005080, 0.004702, 0.006892, 0.007309, 0.007477, 0.007074, 0.004091
#*# 	  0.004843, 0.006601, 0.008211, 0.009628, 0.013409, 0.013565, 0.014126, 0.016253, 0.017143, 0.016295, 0.017050, 0.015932, 0.014698, 0.013930, 0.013846, 0.013362, 0.012303, 0.012129, 0.010495, 0.009087, 0.007573, 0.006743, 0.007971, 0.007432, 0.007619, 0.007650, 0.006555, 0.005482
#*# 	  0.003920, 0.005236, 0.008398, 0.009970, 0.012064, 0.013532, 0.014273, 0.016308, 0.017073, 0.017213, 0.017997, 0.018157, 0.018198, 0.018888, 0.018324, 0.017611, 0.016971, 0.016640, 0.015056, 0.013097, 0.011830, 0.010050, 0.009725, 0.009192, 0.009670, 0.008890, 0.007733, 0.005915
#*# 	  0.004639, 0.006577, 0.010330, 0.011209, 0.014255, 0.016217, 0.016069, 0.018505, 0.019658, 0.018942, 0.022068, 0.021972, 0.022582, 0.023193, 0.022994, 0.023472, 0.023088, 0.022100, 0.021117, 0.017852, 0.015672, 0.013894, 0.012229, 0.012000, 0.011519, 0.011083, 0.009460, 0.007807
#*# 	  0.009463, 0.011504, 0.014318, 0.016283, 0.017896, 0.018950, 0.020585, 0.022139, 0.022871, 0.023822, 0.025406, 0.026864, 0.028235, 0.029146, 0.029532, 0.030196, 0.030028, 0.030355, 0.028273, 0.025473, 0.022814, 0.020367, 0.018239, 0.016296, 0.016639, 0.015711, 0.015101, 0.013442
#*# 	  0.013580, 0.015723, 0.016954, 0.021058, 0.022310, 0.023330, 0.024041, 0.025336, 0.026958, 0.026504, 0.028327, 0.029602, 0.030810, 0.032199, 0.033140, 0.034413, 0.035005, 0.034520, 0.032906, 0.030291, 0.027064, 0.024245, 0.022082, 0.020231, 0.018690, 0.018400, 0.017719, 0.016035
#*# 	  0.016958, 0.018227, 0.021273, 0.023031, 0.024549, 0.025963, 0.026803, 0.026955, 0.027816, 0.027574, 0.029666, 0.030897, 0.031505, 0.032814, 0.034394, 0.036458, 0.037878, 0.038046, 0.035889, 0.033118, 0.028993, 0.026900, 0.024495, 0.022279, 0.021688, 0.020925, 0.020141, 0.018976
#*# 	  0.022513, 0.024117, 0.025831, 0.027615, 0.029643, 0.030437, 0.030825, 0.031190, 0.032010, 0.031568, 0.032931, 0.034037, 0.035124, 0.036731, 0.038223, 0.039770, 0.041329, 0.041668, 0.039827, 0.035900, 0.032773, 0.029972, 0.027354, 0.025577, 0.025643, 0.025057, 0.023614, 0.021552
#*# x_count = 28
#*# y_count = 33
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 65.0
#*# max_x = 230.0
#*# min_y = 57.5
#*# max_y = 222.5
#*#
#*# [beacon model default]
#*# model_coef = 1.5066355233408246,
#*# 	  1.893084634323116,
#*# 	  0.8344053738000634,
#*# 	  0.4363356739886604,
#*# 	  0.32572091115898627,
#*# 	  -0.1436504965128513,
#*# 	  -0.3874664706820457,
#*# 	  0.29255996824656966,
#*# 	  0.31728673467435287,
#*# 	  -0.07271635856180637
#*# model_domain = 1.8356714928203394e-07,1.929539686391822e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 31.605945
#*# model_offset = 0.10000
